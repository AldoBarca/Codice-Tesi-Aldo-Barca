.data 

 img1:  .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga3: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga5: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga6: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga7: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga8: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga9: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8  
 riga10: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga11: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga12: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga13: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
  riga14: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga15: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
  riga16: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 

canale2:  .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga2_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga3_2: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga4_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga5_2: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga6_2: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga7_2: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga8_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga9_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga10_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga11_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga12_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga13_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
  riga14_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga15_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
  riga16_2: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
canale3:  .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 ;
riga2_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga3_3: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga4_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga5_3: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga6_3: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga7_3: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga8_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga9_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga10_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga11_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga12_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga13_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
  riga14_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga15_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
  riga16_3: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
canale4:  .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 ;
riga2_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga3_4: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga4_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga5_4: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga6_4: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga7_4: .word  1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga8_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga9_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga10_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga11_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
riga12_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga13_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
  riga14_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
 riga15_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 
  riga16_4: .word 1,5,3,2,4,7,1,8,1,5,3,2,4,7,1,8 

 
weight: .word 3,0,0,0,2,0,0,0,7   ;è una matrice 3*3 ,per andare verso sinistra aggiungo 8, per cambiare riga aggiungo 24 
weight2: .word 0,0,0,0,0,4,0,0,5 
weight3: .word 0,0,6,7,0,0,8,0,0	 
weight4: .word 0,0,0,0,0,2,7,0,0 



conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
 riga2_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga3_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga4_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga5_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga6_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga7_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga8_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga9_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga10_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
 riga11_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga12_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga13_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 
  riga14_conv: .word 0,0,0,0,0,0,0,0,0,0,0,0,0,0 



 mes1: .asciiz "%d        "
mes2: .asciiz "%d/n"
p1sys5: .space 8
prova: .space 8


.code
;IMG:
;ogni 8 si passa dall' [1,1] allo [1,2] e cosi via
;dopo l'[1,16] aumentando di 8 si passa al [2,1]. 
; per aumentare di una riga, ossia dallo [1,1] al [2,1] si aumenta di 128 .
;quindi se un indice j è multiplo di 128 vuol dire che si è passati alla riga successiva
;per passare al corrispettivo di un elemento nell'altro canale  matematicamente  si deve aumentare di aumentare di 2048,ossia 16*16*8 
;di conseguenza banalmente se un ipotetico indice i supera i 2048 si è passati al secondo canale e cosi via per i multipli nel caso di canali multipli(tipo 4).







;inizio for che itera il canale ipotizzando 4 canali                                                                                                                                                                                                        CANALE: S4 WEIGHT S0 IMG
daddi $s4,$0,0  ; variabile per il canale del weight
daddi $s0,$0,0 ; channel=0 ,channel in s0  variabile per il canale dell'img
for_canale: slti $t0,$s0,8191 ; è letteralmente i<nChannel dove ogni canale dista 2048 byte l'uno dall'altro
beq $t0,$0,fine_for_canale	


;inizio for che cambia indice di riga                                                                                                                                                                                                           RIGHE X : S1 CONV     S5 IMG
 daddi $s1,$0,0 ;x=0, x in s1 per la matrice 14 per 14
daddi $s5,$0,0 ; cambio riga di una 16 per 16
for_x: slti $t0,$s1,1567 ; equivale a s1<112*14  scorro tra le righe della 14 per 14, ad ogni ciclo aumento di 112 fino ad un massimo di 1456 
beq $t0,$0,fine_for_x
  

;inizio for y cioe scorrendo nella riga                                                                                                                                                                                                         NELLA RIGA Y : S2 PER ENTRAMBI
 daddi $s2,$0,0 ; y=0 ,y in s2
for_y: slti $t0,$s2,111  ; scorro nella stessa riga cambiando l'indice di colonna ,aumento ogni ciclo di 8 fino ad un massimo di 104
beq $t0,$0,fine_for_y

;inizio for p
daddi $s3,$0,0 ; inizializzo p per il weight ,aumenta di 24 fino ad un massimo di 48 per il terzo p                                                                                                            P : S3 WEIGHT  S7 IMG
daddi $s7,$0,0   ;p per l'img

for_p: slti $t0,$s7,384  ;in pratica è un ciclo che si ripete 3 volte aumentando una riga per volta il weight (3per 3) e l'img (16 per 16)
beq $t0,$0,fine_for_p



;inizio for q
daddi $s6,$0,0;inizializzo q ,    $s6=q                                                                                                                                                                                                              Q : S6 PER ENTRAMBE Q<8*3
for_q:  slti $t0,$s6,23  
beq $t0,$0,fine_for_q

;nucleo 
dadd $t1, $s2,$s1  ; calcolo in t1 x+y della conv ;da fare prima del q e del p
ld $t2, conv($t1) ; carico in t2 conv[x][y]      ;da fare prima del p e q

dadd $t3,$s3,$s6 ;metto in t3 p+q per il weight
dadd $t3,$t3,$s4 ; cambio il canale del weight.
ld $t4,weight($t3)  ;in t4 metto weight[channel][p][q]   //


dadd $t3,$s7,$s5   ; [x+p] img
dadd $t5, $s6,$s2  ;y+q  img
dadd $t5,$t5,$t3 ;x+p+y+q                                                                                                                                                                                                               ALGORITMO CONVOLUZIONE
dadd $t5,$t5,$s0;x+p+y+q con canale aggiornato

ld $t6, img1($t5)  ; img[channel][x+p][y+q] in t6 //

dmult $t6,$t4; img... per weight...

mflo $t7;sposto in t7 i bit meno significativi

dadd $t8,$t2,$t7 ;calcolo conv+ il prodotto come nell'algoritmo in c

;a questo punto metto in store nella locazione di memoria di conv[x][y] 


daddi $t1,$t1,conv
sd $t8,0($t1) ;sposto dopo la 191







daddi $s6,$s6,8
j for_q                                                                                                                                                                                                                   ;      FINE Q
fine_for_q:

daddi $s3,$s3,24
daddi $s7,$s7,128
j for_p

fine_for_p:                                                                                                                                                                                                                 ;FINE P



                                                                                                                                                                                                    







daddi $s2,$s2,8 ;aumento y di 8 cioe passo all'elemento successivo di una riga
j  for_y
fine_for_y:                                                                                                                                                                                                                 ; FINE Y




daddi $s1,$s1,112 ;aumento s1 di 112, cioe 14*8  una riga di una14 per 14
daddi $s5,$s5,128 ; riga di una 16 per 16                                                                                                                                                                FINE X
j  for_x
fine_for_x:


daddi $s4,$s4,72  ;canale del weight
daddi $s0,$s0,2048;canale   dell'img                                                                                                                                                                       FINE CANALE
j for_canale
fine_for_canale:

















syscall 0
